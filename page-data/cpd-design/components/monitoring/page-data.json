{"componentChunkName":"component---src-pages-cpd-design-components-monitoring-index-mdx","path":"/cpd-design/components/monitoring/","result":{"pageContext":{"frontmatter":{"title":"Cloud Pak For Data Monitoring Overview"},"relativePagePath":"/cpd-design/components/monitoring/index.mdx","titleType":"page","MdxNode":{"id":"7fbf9a19-01f9-558d-a7a4-2bf84dee0af2","children":[],"parent":"5725d0a2-ec0a-5294-bebd-36e074484984","internal":{"content":"---\ntitle: Cloud Pak For Data Monitoring Overview\n---\n\n## Monitoring Cloud Pak for Data\n\nFor monitoring of Cloud Pak for Data we make use of the OpenShift Monitoring framework. The observations generated by Cloud Pak for Data are pushed to the OpenShift Monitoring Prometheus endpoint. This will allow (external) monitoring tools to combine the observations from the OpenShift platform and Cloud Pak for Data from a single source. \n\n![Monitoring overview](cloud-pak-deployer-monitors.png)\n\n\nTo deploy Cloud Pak for Data Monitors, its is mandatory to enable the OpenShift monitoring. OpenShift monitoring is activated via the `openshift_monitoring` object. For Cloud Pak for Data to be able to push its Prometheus metrics to OpenShift monitoring, the `user_worload` must be set to enabled. To make the openShift monitoring data persistent, the (optional) setting `pvc_storage_class` and `pvc_storage_size_gb` can be set. To enable Prometheus RemoteWrite, use the `remote_rewrite_url`. \n\nOptionally it is possible to install the community operator of Grafana, which provides the ability to build your own Grafana Dashboards. The `grafana_project` specifies the OpenShift project in which Grafana is deployed. The installation of Grafana creates a default local administrative user with username `root` and password `secret`. Grafana can be accessed via the OpenShift Route that is exposed in the `grafana_project`.\n\n```\nopenshift_monitoring:\n- openshift_cluster_name: pluto-01\n  user_workload: enabled\n  pvc_storage_class: ibmc-vpc-block-retain-general-purpose\n  pvc_storage_size_gb: 100\n  remote_rewrite_url: http://www.example.com:1234/receive\n  grafana_operator: enabled\n  grafana_project: grafana\n```\n\nThe observations of Cloud Pak for Data are generated using the zen-watchdog component, which is part of the cpd_platform cartridge and therefore available on each instance of Cloud Pak for Data. Part of the zen-watchdog installation is a set of monitors which focus on the technical deployment of Cloud Pak for Data (e.g. running pods and bound Persistent Volume Claims (pvcs)).\n\n## Add custom monitors\n\nAdditional monitors which focus more on the operational usage of Cloud Pak for Data can be deployed as well. Click on each monitor for a detailed description and the list of observations which are generated by the monitor. \n* [Global Platform connections](/cpd-design/components/monitoring/global-platform-connections)\n* [Watson Studio - Runtimes](/cpd-design/components/monitoring/watson-studio-runtimes)\n\n## Configuring custom monitors\n\nCustom monitors are added via the `cpd_monitors` object, which contains a list of monitor sets. Each monitor set contains a set of default parameters, which can be overridden in the configuration of each monitor. \n\n```\ncp4d_monitors:\n- name: cp4d-monitor-set-1\n  cp4d_instance: zen-40\n  openshift_cluster_name: pluto-01\n  default_monitor_source_repo: https://github.com/IBM/cloud-pak-deployer-monitors\n  default_monitor_source_token_secret: monitors_source_repo_secret\n  default_monitor_target_cr: de.icr.io/monitorrepo  \n  default_monitor_target_cr_user_secret: monitors_target_cr_username\n  default_monitor_target_cr_password_secret: monitors_target_cr_password\n  # List of monitors\n  monitors:\n```\n\nThe monitors are kept in a github source repository, specified by the `default_monitor_source_repo`, the token to access the source repository should be available in the configured vault and is reference in the `default_monitor_source_token_secret`.\n\nThe Cloud Pak Deployer will use OpenShift S2i (Source to Image) to build the monitor. The resulting image can be pushed to either the internal image registry of OpenShift, or pushed to an external container registry, specified by the `default_monitor_target_cr`. If the `target_cr` parameters are omitted, the default internal image registry of OpenShift is used. \n\n```\n  # List of monitors\n  monitors:\n  - name: cp4d-platform-global-connections\n    #monitor_source_repo:             \n    #monitor_source_token_secret:    \n    #monitor_target_cr:              \n    #monitor_target_cr_user_secret:  \n    #monitor_target_cr_user_password:\n    context: cp4d-platform-global-connections\n    label: latest\n    schedule: \"*/15 * * * *\"\n    # List of monitor Event Types\n    event_types:\n```\n\nThe `monitors` contains the list of monitors. The `name` of the monitor must consist of lower case alphanumeric characters, - or ., and must start and end with an alphanumeric character.  \nEach monitor can override the `default_` settings using the `monitor_source_repo`, `monitor_source_token_secret`, `monitor_target_cr`, `monitor_target_cr_user_secret` and `monitor_target_cr_user_password`.  \nThe `context` sets the subfolder in the github source repository where the monitor is available. The `label` sets the label of the pushed image, if omitted, it uses `latest`. The `schedule` set the interval of the cronjob that runs the monitor. \n\n<InlineNotification kind=\"info\">\nBe aware the running monitors requests system resources from the cluster. It is therefore important to set the interval of each monitor based on the expected changes made to the object(s) it monitors.\n</InlineNotification>\n\n```\n    # List of monitor Event Types\n    event_types:\n    - name: \"global_connections_count\"\n      simple_name: \"Number of CP4D Platform connections\"\n      alert_type: \"platform\"\n      short_description: \"Number of CP4D Platform connections\"\n      long_description: \"Number of CP4D Platform connections: <global_connections_count>\"\n      resolution: \"none\"\n      reason_code_prefix: \"80\"\n    - name: \"global_connection_valid\"\n      simple_name: \"Test CP4D Platform connection\"\n      alert_type: \"platform\"\n      short_description: \"Test CP4D Platform connection\"\n      long_description: \"Test result CP4D Platform connection: <global_connection_valid>\"\n      resolution: \"Validate the connection properties\"\n      reason_code_prefix: \"80\"\n```\n\nEach `monitors` entry **must** contain at least 1 `event_types`. The `event_types` represent the observations that will be generated by the monitor and the information that will be pushed to the OpenShift Monitoring component. The `name` can only contain lowercase, numbers and _ characters. The `simple_name`, `short_description` and `long_description` are using in the Cloud Pak for Data User interface, when displaying the events in the Alerts and Events page. The **item** in the long_description must be part of the `metadata` in the implementation of the monitor when construction the event payload. The `reason_code_prefix` is used for SNMP Alerts, it is recommended for custom monitors to use a custom prefix greater than 60.  ","type":"Mdx","contentDigest":"e91c505742d0270df7ef8dd6e4a512e9","owner":"gatsby-plugin-mdx","counter":246},"frontmatter":{"title":"Cloud Pak For Data Monitoring Overview"},"exports":{},"rawBody":"---\ntitle: Cloud Pak For Data Monitoring Overview\n---\n\n## Monitoring Cloud Pak for Data\n\nFor monitoring of Cloud Pak for Data we make use of the OpenShift Monitoring framework. The observations generated by Cloud Pak for Data are pushed to the OpenShift Monitoring Prometheus endpoint. This will allow (external) monitoring tools to combine the observations from the OpenShift platform and Cloud Pak for Data from a single source. \n\n![Monitoring overview](cloud-pak-deployer-monitors.png)\n\n\nTo deploy Cloud Pak for Data Monitors, its is mandatory to enable the OpenShift monitoring. OpenShift monitoring is activated via the `openshift_monitoring` object. For Cloud Pak for Data to be able to push its Prometheus metrics to OpenShift monitoring, the `user_worload` must be set to enabled. To make the openShift monitoring data persistent, the (optional) setting `pvc_storage_class` and `pvc_storage_size_gb` can be set. To enable Prometheus RemoteWrite, use the `remote_rewrite_url`. \n\nOptionally it is possible to install the community operator of Grafana, which provides the ability to build your own Grafana Dashboards. The `grafana_project` specifies the OpenShift project in which Grafana is deployed. The installation of Grafana creates a default local administrative user with username `root` and password `secret`. Grafana can be accessed via the OpenShift Route that is exposed in the `grafana_project`.\n\n```\nopenshift_monitoring:\n- openshift_cluster_name: pluto-01\n  user_workload: enabled\n  pvc_storage_class: ibmc-vpc-block-retain-general-purpose\n  pvc_storage_size_gb: 100\n  remote_rewrite_url: http://www.example.com:1234/receive\n  grafana_operator: enabled\n  grafana_project: grafana\n```\n\nThe observations of Cloud Pak for Data are generated using the zen-watchdog component, which is part of the cpd_platform cartridge and therefore available on each instance of Cloud Pak for Data. Part of the zen-watchdog installation is a set of monitors which focus on the technical deployment of Cloud Pak for Data (e.g. running pods and bound Persistent Volume Claims (pvcs)).\n\n## Add custom monitors\n\nAdditional monitors which focus more on the operational usage of Cloud Pak for Data can be deployed as well. Click on each monitor for a detailed description and the list of observations which are generated by the monitor. \n* [Global Platform connections](/cpd-design/components/monitoring/global-platform-connections)\n* [Watson Studio - Runtimes](/cpd-design/components/monitoring/watson-studio-runtimes)\n\n## Configuring custom monitors\n\nCustom monitors are added via the `cpd_monitors` object, which contains a list of monitor sets. Each monitor set contains a set of default parameters, which can be overridden in the configuration of each monitor. \n\n```\ncp4d_monitors:\n- name: cp4d-monitor-set-1\n  cp4d_instance: zen-40\n  openshift_cluster_name: pluto-01\n  default_monitor_source_repo: https://github.com/IBM/cloud-pak-deployer-monitors\n  default_monitor_source_token_secret: monitors_source_repo_secret\n  default_monitor_target_cr: de.icr.io/monitorrepo  \n  default_monitor_target_cr_user_secret: monitors_target_cr_username\n  default_monitor_target_cr_password_secret: monitors_target_cr_password\n  # List of monitors\n  monitors:\n```\n\nThe monitors are kept in a github source repository, specified by the `default_monitor_source_repo`, the token to access the source repository should be available in the configured vault and is reference in the `default_monitor_source_token_secret`.\n\nThe Cloud Pak Deployer will use OpenShift S2i (Source to Image) to build the monitor. The resulting image can be pushed to either the internal image registry of OpenShift, or pushed to an external container registry, specified by the `default_monitor_target_cr`. If the `target_cr` parameters are omitted, the default internal image registry of OpenShift is used. \n\n```\n  # List of monitors\n  monitors:\n  - name: cp4d-platform-global-connections\n    #monitor_source_repo:             \n    #monitor_source_token_secret:    \n    #monitor_target_cr:              \n    #monitor_target_cr_user_secret:  \n    #monitor_target_cr_user_password:\n    context: cp4d-platform-global-connections\n    label: latest\n    schedule: \"*/15 * * * *\"\n    # List of monitor Event Types\n    event_types:\n```\n\nThe `monitors` contains the list of monitors. The `name` of the monitor must consist of lower case alphanumeric characters, - or ., and must start and end with an alphanumeric character.  \nEach monitor can override the `default_` settings using the `monitor_source_repo`, `monitor_source_token_secret`, `monitor_target_cr`, `monitor_target_cr_user_secret` and `monitor_target_cr_user_password`.  \nThe `context` sets the subfolder in the github source repository where the monitor is available. The `label` sets the label of the pushed image, if omitted, it uses `latest`. The `schedule` set the interval of the cronjob that runs the monitor. \n\n<InlineNotification kind=\"info\">\nBe aware the running monitors requests system resources from the cluster. It is therefore important to set the interval of each monitor based on the expected changes made to the object(s) it monitors.\n</InlineNotification>\n\n```\n    # List of monitor Event Types\n    event_types:\n    - name: \"global_connections_count\"\n      simple_name: \"Number of CP4D Platform connections\"\n      alert_type: \"platform\"\n      short_description: \"Number of CP4D Platform connections\"\n      long_description: \"Number of CP4D Platform connections: <global_connections_count>\"\n      resolution: \"none\"\n      reason_code_prefix: \"80\"\n    - name: \"global_connection_valid\"\n      simple_name: \"Test CP4D Platform connection\"\n      alert_type: \"platform\"\n      short_description: \"Test CP4D Platform connection\"\n      long_description: \"Test result CP4D Platform connection: <global_connection_valid>\"\n      resolution: \"Validate the connection properties\"\n      reason_code_prefix: \"80\"\n```\n\nEach `monitors` entry **must** contain at least 1 `event_types`. The `event_types` represent the observations that will be generated by the monitor and the information that will be pushed to the OpenShift Monitoring component. The `name` can only contain lowercase, numbers and _ characters. The `simple_name`, `short_description` and `long_description` are using in the Cloud Pak for Data User interface, when displaying the events in the Alerts and Events page. The **item** in the long_description must be part of the `metadata` in the implementation of the monitor when construction the event payload. The `reason_code_prefix` is used for SNMP Alerts, it is recommended for custom monitors to use a custom prefix greater than 60.  ","fileAbsolutePath":"/home/runner/work/cloud-pak-deployer/cloud-pak-deployer/doc/src/pages/cpd-design/components/monitoring/index.mdx"}}},"staticQueryHashes":["1364590287","137577622","137577622","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550"]}